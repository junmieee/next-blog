---
title: 'Next.jsì— Redux ì ìš©í•˜ê¸°'
date: '2022-12-24'
description: 'Nextjsì— Redux ì ìš©'
thumbnail: '/images/posts/blog/Redux-Nextjs.png'
tags: 
  - Next.js
  - Redux

draft: false

---

# Redux

# ğŸ· Next.jsì— Reduxë¥¼ ì ìš©í•´ ë³´ì

ì¸í”„ëŸ°ì—ì„œ Zerochoi(ì œë¡œì´ˆ)ë‹˜ì˜ Nobirdê°•ì¢Œë¥¼ ìˆ˜ê°•í•˜ë©° íŠ¸ìœ„í„°ì™€ ë¹„ìŠ·í•œ SNS ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë¡  í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ëŠ” ì¤‘ Next.jsì— Reduxë¥¼ ì‹¤ì œë¡œ êµ¬í˜„í•˜ëŠ” ë‚´ìš©ì„ ì½”ë“œ ì˜ˆì œì™€ í•¨ê»˜ ê¸°ë¡í•´ ë³´ê³ ì í•œë‹¤.

### ğŸ’ Why Redux?

ê·¸ ì „ì— ì´ í”„ë¡œì íŠ¸ì—ì„œ ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë¦¬ë•ìŠ¤ë¥¼ ì±„íƒí•œ ì´ìœ ë¥¼ ë¦¬ë•ìŠ¤ì˜ ì¥ë‹¨ì ì„ í†µí•´ ì‚´í´ë³´ì. 

í”„ë¡œì íŠ¸ì˜ ê·œëª¨ê°€ ì–´ëŠì •ë„ ì´ìƒì´ ë˜ë©´ ì»´í¬ë„ŒíŠ¸ë¥¼ ì ì ˆí•˜ê²Œ ë¶„ë¦¬í•´ì£¼ëŠ” ê²ƒì´ í•„ìˆ˜ë‹¤. ì»´í¬ë„ŒíŠ¸ê°€ ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ì§ˆìˆ˜ë¡ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì— ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ë¬´ì²™ ê¹Œë‹¤ë¡œì›Œ ì§€ëŠ”ë° ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì¤‘ì•™ì—ì„œ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” Redux, Mobx, ContextAPI ë“±ì˜ ìƒíƒœê´€ë¦¬ í”„ë¡œê·¸ë¨ì„ ì±„íƒí•œë‹¤. ì—¬ëŸ¬ ê°€ì§€ ìƒíƒœê´€ë¦¬ í”„ë¡œê·¸ë¨ ì¤‘ íŒ€ì´ë‚˜ ë³¸ì¸ì˜ ì„±í–¥ì— ë§ê²Œ ì·¨ì‚¬ ì„ íƒì—ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 

- ReduxëŠ” ì›ë¦¬ê°€ ê°„ë‹¨í•˜ê¸° ë•Œë¬¸ì— ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆëŠ” ìƒí™©ì´ ë§ì´ ì—†ê³  ì—ëŸ¬ê°€ ë‚˜ë”ë¼ê³  ì¶”ì ì´ ì˜ ë˜ì–´ ì•±ì´ ì•ˆì •ì ì´ì—¬ ì§„ë‹¤.
- actionê³¼ stateë¥¼ ì´ìš©í•´ ë””ë²„ê¹…ì´ ì‰¬ì›Œì ¸ ì¶”ì ì´ ìš©ì´í•´ì§„ë‹¤.
- ëŒ€ì‹  ì½”ë“œëŸ‰ì´ ë‹¤ë¥¸ ìƒíƒœê´€ë¦¬ í”„ë¡œê·¸ë¨ì— ë¹„êµí•´ ë§ì€ ê²ƒì´ ë‹¨ì ì´ë‹¤.

Next.jsì—ì„œ Redux ì ìš©ì„ ê°„í¸í•˜ê²Œ ë„ì™€ì£¼ëŠ” Next Redux Wrapper ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ ì§„í–‰í•œë‹¤. 

 

```jsx
//Next redux wrapper ì„¤ì¹˜
npm i next-redux-wrapper
```

### ğŸ‘ ë³¸ê²©ì ìœ¼ë¡œ Next.jsí”„ë¡œì íŠ¸ì— Reduxë¥¼ ì ìš©í•´ ë³´ì.

ë£¨íŠ¸ í´ë”ì— Storeí´ë”ë¥¼ ë§Œë“¤ê³  ê·¸ ì•ˆì— ConfigureStore.jsíŒŒì¼ì„ ìƒì„±í•´ ì¤€ í›„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ ì¤€ë‹¤. 

```jsx
//ConfigureStore.js

import { createWrapper } from 'next-redux-wrapper';

// configureStore ì—¬ê¸°ì—ì„œëŠ” ì¼ë°˜ reduxì™€ ë¹„ìŠ·
const configureStore = () => {
	
   
};

// { debug: process.env.NODE_ENV === "development" }
const wrapper = createWrapper(configureStore, {
    debug: process.env.NODE_ENV === 'development',
}); // ë‘ë²ˆì§¸ëŠ” ì˜µì…˜ ê°ì²´

export default wrapper
```

ìœ„ì˜ ì½”ë“œë¡œ ê¸°ë³¸ì ì¸ redux ì„¸íŒ…ì„ í•´ ë†“ì€ í›„ App.jsì—ì„œ high order componentë¡œ wrapperë¡œ ê°ì‹¸ì¤€ë‹¤. 

```jsx
//app.js

import React from 'react';
import PropTypes from 'prop-types';
import 'antd/dist/antd.css';
import Head from 'next/head';
import wrapper from '../store/configureStore';

const NodeBird = ({ Component }) => {
    return (
        <>
            <Head>
                <meta charSet='utf-8'></meta>
                <title>NodeBird</title>
            </Head>
            <Component />
        </>
    );
};

NodeBird.prototype = {
    Component: PropTypes.elementType.isRequired,
}

export default wrapper.withRedux(NodeBird);
```

<aside>
ğŸ’¡ Next.jsì— Reduxë¥¼ ì ìš©í•  ë•ŒëŠ” ê¸°ì¡´ì˜ ë¦¬ì•¡íŠ¸ì— Reduxë¥¼ ì ìš©í•˜ëŠ” ê²ƒê³¼ëŠ” ë‹¤ë¥´ê²Œ Providerë¡œ ê°ì‹¸ì£¼ì§€ ì•ŠëŠ”ë‹¤. ì˜ˆì „ ë²„ì „ì—ì„œëŠ” Providerë¡œ ê°ì‹¸ì¤¬ì§€ë§Œ Next.js 6ë²„ì „ ë¶€í„°ëŠ” ìì²´ì ìœ¼ë¡œ Providerë¡œ ê°ì‹¸ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì½”ë“œê°€ í•„ìš” ì—†ë‹¤.

</aside>

```jsx

//app.js

...

const NodeBird = ({ Component }) => {
    return (
        <>
					<Provider store={store}> //
            <Head>
                <meta charSet='utf-8'></meta>
                <title>NodeBird</title>
            </Head>
            <Component />
					<Provider>
        </>
    );
};

NodeBird.prototype = {
    Component: PropTypes.elementType.isRequired,
}

export default wrapper.withRedux(NodeBird)
```

configureStore.jsì— Reducerë¥¼ ì •ì˜ í•œ í›„ Reducerë¥¼ ì½”ë“œë¡œ ì‘ì„±í•˜ì. 

```jsx
//ConfigureStore.js

import { createWrapper } from 'next-redux-wrapper';

import reducer from '../reducers'; //reducer ë¶ˆëŸ¬ì˜¤ê¸°

const configureStore = () => {
		const store = createStore(reducer);
		return store;
   
};

const wrapper = createWrapper(configureStore, {
    debug: process.env.NODE_ENV === 'development',
}); // ë‘ë²ˆì§¸ëŠ” ì˜µì…˜ ê°ì²´

export default w
```

index.js íŒŒì¼ì—ì„œëŠ” **`combineReducers`**í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ **`user`**ì™€ **`post`**ë‘ ê°œì˜ Reducerë¥¼ í•©ì³¤ë‹¤. **`combineReducers`**í•¨ìˆ˜ëŠ” ì—¬ëŸ¬ ê°œì˜ Reducer í•¨ìˆ˜ë¥¼ ë°›ì•„ì„œ í•˜ë‚˜ë¡œ í•©ì¹œ ìƒˆë¡œìš´ Reducer í•¨ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.

```jsx
//Reducers > index.js

import { HYDRATE } from 'next-redux-wrapper';
import { combineReducers } from 'redux';

import user from './user';
import post from './post';

// (ì´ì „ìƒíƒœ, ì•¡ì…˜) => ë‹¤ìŒìƒíƒœ
const rootReducer = (state, action) => {
    switch (action.type) {
        case HYDRATE:
            console.log('HYDRATE', action);
            return action.payload;
        default: {
            const combinedReducer = combineReducers({
                user,
                post,
            });
            return combinedReducer(state, action);
        }
    }
};

export default rootReducer;
```



âœ“ **`initialState`**ê°ì²´ëŠ” **`user`** Reducerì˜ ì´ˆê¸° ìƒíƒœë¥¼ ì •ì˜í•œë‹¤. ì´ ê°ì²´ëŠ”**`mainPosts`**, **`singlePost`**, **`imagePaths`** ë¥¼ í¬í•¨í•œ ìƒíƒœ í”„ë¡œí¼í‹°ë¥¼ ê°€ì§€ê³  ìˆë‹¤. 

âœ“ **`LOAD_POST_REQUEST`**, **`LOAD_POST_SUCCESS`**, **`LOAD_POST_FAILURE`** ìƒìˆ˜ëŠ” **`user`** Reducerì—ì„œ ì‚¬ìš©ë˜ëŠ” ì•¡ì…˜ íƒ€ì…ì„ ì •ì˜í•œë‹¤. 

âœ“ **`reducer`**í•¨ìˆ˜ëŠ” ì´ì „ ìƒíƒœ(**`state`**)ì™€ ì•¡ì…˜(**`action`**)ì„ ë°›ì•„ì„œ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë°˜í™˜í•œë‹¤. í•´ë‹¹ ì½”ë“œëŠ” **`immer`**ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ **`produce`**í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶ˆë³€ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë§Œë“¤ê³  ìˆë‹¤. **`produce`**í•¨ìˆ˜ ë‚´ë¶€ì—ì„œëŠ” **`draft`**ë¼ëŠ” ê°ì²´ë¥¼ ìˆ˜ì •í•˜ë©´ì„œ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë§Œë“ ë‹¤. **`draft`**ê°ì²´ëŠ” ì´ì „ ìƒíƒœì™€ ë˜‘ê°™ì€ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆì§€ë§Œ, ìˆ˜ì •ì´ ê°€ëŠ¥í•œ ê°ì²´ì´ë‹¤.

```
//user.js

import produce from 'immer';


export const initialState = {
    mainPosts: [],
    singlePost: null,
    imagePaths: [],
...
}


export const LOAD_POST_REQUEST = 'LOAD_POST_REQUEST';
export const LOAD_POST_SUCCESS = 'LOAD_POST_SUCCESS';
export const LOAD_POST_FAILURE = 'LOAD_POST_FAILURE';

...

const reducer = (state = initialState, action) => produce(state, (draft) => {

... 

		case LOAD_POST_REQUEST:
		            draft.loadPostLoading = true;
		            draft.loadPostDone = false;
		            draft.loadPostError = null;
		            break;
		        case LOAD_POST_SUCCESS:
		            draft.loadPostLoading = false;
		            draft.loadPostDone = true;
		            draft.singlePost = action.data;
		            break;
		        case LOAD_POST_FAILURE:
		            draft.loadPostLoading = false;
		            draft.loadPostError = action.error;
		            break;


... 

}
```